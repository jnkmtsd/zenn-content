---
title: "Webhook を理解する"
emoji: "⚓"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["webhook"]
published: false
---

## はじめに

## Webhook とは

**Webhook とは、アプリケーションに対する何らかのイベントをトリガーに、あらかじめ登録しておいた URL へ HTTP POST リクエストを送信する仕組みのことです。**

イベントとは、たとえば GitHub のリポジトリに対する push などのことです。
POST リクエストには、認証のためのヘッダーや、イベントの内容を含むボディが含まれます。

具体例としては以下がわかりやすいです。

https://docs.github.com/ja/webhooks/webhook-events-and-payloads

送信元のサービスは送信先 URL を管理画面などから登録できるようになっているケースが多いです。
自社の Web サーバーを送信先として指定することで、自社サービスと連携することができます。

このように、Webhook の仕組み自体はシンプルです。

## Webhook の設計

概ね考える観点は以下 3 点です。

- セキュリティ
- UI
- POST するデータ

### セキュリティ

第一に、**送信先に対して正規の送信元だと偽っておかしな POST リクエストを送れないようにする**必要があります。

色々やり方はあると思いますが、GitHub の場合は以下のようなやり方で実現しています。
HMAC 署名を用いたものです。

https://docs.github.com/ja/webhooks/using-webhooks/validating-webhook-deliveries

送信先で IP 制限を設けるというのも有効です。
つまり、送信元の IP のみ通信を受け付けるよう Web サーバーやファイアウォールなどを設定しておきます。

第二に、**色々な送信先 URL を設定されることを考慮する**必要があります。

たとえば、`localhost`や送信元ネットワークが属する別サーバーの URL を指定されても問題ない設計になっていますか？
外部からのアクセスは遮断されていても、内部（送信元）からのアクセスはあっさり許可されて不正利用されてしまうかもしれません。

このあたりを考慮して設計、テストしましょう。

他にも、署名した日時を検証したり、同一のリクエストを複数回処理しないようにしたり、といった選択肢も検討しましょう。

### UI

### POST するデータ

## まとめ
