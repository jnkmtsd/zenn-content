---
title: "バックエンドエンジニアのためのネットワーク基礎【Web サーバー編】"
emoji: "🌐"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ネットワーク"]
published: true
---

## はじめに

本シリーズの執筆意図などは本シリーズ初回の記事に書いてあります。

- [初回のブラウザ編 > ネットワーク知識の重要性](https://zenn.dev/jnkmtsd/articles/0d129a7aa0947b#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E7%9F%A5%E8%AD%98%E3%81%AE%E9%87%8D%E8%A6%81%E6%80%A7)
- [初回のブラウザ編 > ネットワーク知識を記憶することの困難性](https://zenn.dev/jnkmtsd/articles/0d129a7aa0947b#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E7%9F%A5%E8%AD%98%E3%82%92%E8%A8%98%E6%86%B6%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AE%E5%9B%B0%E9%9B%A3%E6%80%A7)
- [初回のブラウザ編 > 困難性とどう向き合うか](https://zenn.dev/jnkmtsd/articles/0d129a7aa0947b#%E5%9B%B0%E9%9B%A3%E6%80%A7%E3%81%A8%E3%81%A9%E3%81%86%E5%90%91%E3%81%8D%E5%90%88%E3%81%86%E3%81%8B)

### 本シリーズの記事一覧

- [バックエンドエンジニアのためのネットワーク基礎【ブラウザ編】](https://zenn.dev/jnkmtsd/articles/0d129a7aa0947b)
- [バックエンドエンジニアのためのネットワーク基礎【DNS サーバー編】](https://zenn.dev/jnkmtsd/articles/e59e42beec39e0)
- [バックエンドエンジニアのためのネットワーク基礎【プロトコル・スタック TCP 接続編】](https://zenn.dev/jnkmtsd/articles/e0ecb28f1875f2)
- [バックエンドエンジニアのためのネットワーク基礎【プロトコル・スタック TCP 送受信編】](https://zenn.dev/jnkmtsd/articles/37a25508b30635)
- [バックエンドエンジニアのためのネットワーク基礎【プロトコル・スタック IP 編】](https://zenn.dev/jnkmtsd/articles/61f104becc1750)
- [バックエンドエンジニアのためのネットワーク基礎【イーサネット編】](https://zenn.dev/jnkmtsd/articles/c50f9113995773)
- [バックエンドエンジニアのためのネットワーク基礎【プロトコル・スタック UDP 編】](https://zenn.dev/jnkmtsd/articles/46615811cadd72)
- [バックエンドエンジニアのためのネットワーク基礎【ハブ編】](https://zenn.dev/jnkmtsd/articles/24874950f6e4ea)
- [バックエンドエンジニアのためのネットワーク基礎【ルーター編】](https://zenn.dev/jnkmtsd/articles/e11381c0cafe3e)
- [バックエンドエンジニアのためのネットワーク基礎【アクセス回線編】](https://zenn.dev/jnkmtsd/articles/b8588f4326dc73)
- [バックエンドエンジニアのためのネットワーク基礎【プロバイダー編】](https://zenn.dev/jnkmtsd/articles/52b465bc9d8d97)
- バックエンドエンジニアのためのネットワーク基礎【Web サーバー編】　 ← 本記事

### 本記事で書かないこと

- Web サーバー以外の動作
  - 例）LAN アダプタ、ネットワーク・アプリケーション　など
- プロトコルなどの詳しい仕様

## 全体像

今回は次の 2 テーマでお送りします。

- Web サーバーを取り巻く関連技術
  - ファイアウォール
  - 負荷分散
  - キャッシュ・サーバー
- Web サーバーの動作

## Web サーバーを取り巻く関連技術

### ファイアウォール

パケット・フィルタリング型が主流なので、それに絞って説明します。

パケット・フィルタリングとは、**パケットのヘッダー情報を見て、そのパケットを通すかどうかを判断すること**です。

送信元あるいは宛先の MAC アドレス・IP アドレスや、TCP コントロール・ビットなどに条件を設定することができます。
たとえば、特定の IP アドレスからのアクセスを許可したり、Web サーバーからインターネットへのアクセスのみをできないようにしたりできます。

インターネットと社内 LAN を行き来するパケットはアドレス変換しないといけないので、その設定が必要です。
また、アドレス変換の特性上、インターネットから社内 LAN へはアクセスできません。

:::message
パケット・フィルタリングは、パケットの中身を見ないことに注意してください。
:::

### 負荷分散

やり方は大きく分けて 2 つあります。

- DNS ラウンドロビン
- ロードバランサー

#### DNS ラウンドロビン

DNS ラウンドロビンでは、**DNS サーバーが複数の IP アドレスを返す**ようにします。
同じドメイン名に対して、複数の異なる IP アドレスを対応づけておくことで、負荷分散を実現します。

ただし、これには問題点があります。
止まってしまっている Web サーバーの IP アドレスを返却したり、複数ページにまたがってやり取りするアプリケーションがうまく動かなかったりします。

こういった問題点を解決するのがロードバランサーです。

#### ロードバランサー

ロードバランサーは、**DNS サーバーにロードバランサー自身の IP アドレスを登録**します。
そしてロードバランサーがどの Web サーバーにアクセスするか判断して、その Web サーバーにリクエスト・メッセージを転送します。

判断の方法は次のとおりです。

- 複数ページにまたがらない場合は、Web サーバーの負荷状態やスペックを元に判断
- 複数ページにまたがる場合は、HTTP のヘッダー情報を元に同じ Web サーバーに転送するよう判断

### キャッシュ・サーバー

やり方は大きく分けて 3 つあります。

- リバース・プロキシ
- フォワード・プロキシ
- コンテンツ配信サービス

#### リバース・プロキシ

リバース・プロキシは、**Web サーバー側 LAN に設置**されます。

ロードバランサーと同じように、リバース・プロキシの IP アドレスを DNS サーバーに登録します。
リクエストを受け取ったら、その内容を調べて、そのデータが自分のキャッシュに保存されているかどうか調べます。

保存されていなかったら、Web サーバーにリクエストを転送します。
転送候補が複数あったら、たとえばリクエストの URI に書いてあるディレクトリなどで判断します。

保存されていたら、Web サーバーにデータの変更があるかどうかを確認します。
変更がなければ、その旨をリバース・プロキシに送り返します。

#### フォワード・プロキシ

フォワード・プロキシは、**クライアント側 LAN に設置**されます。

フォワード・プロキシを使う場合は、ブラウザの設定画面でフォワード・プロキシの IP アドレスを設定します。
そうすると、ブラウザはすべてのリクエストをフォワード・プロキシに送ります。
フォワード・プロキシを使う場合は、リクエストの URI に目的の URL が書いてあるので、それを見て転送します。
キャッシュがあれば、それをクライアントに返します。

#### コンテンツ配信サービス

コンテンツ配信サービスは、**インターネット上に設置**されます。

コンテンツ配信サービスの事業者は、主要なプロバイダーと契約して、そこに多数のキャッシュ・サーバーを設置します。
同時に、Web サーバー運営者とも契約して、Web サーバーとキャッシュ・サーバーを連携させます。

リクエスト・メッセージがキャッシュ・サーバーに届く仕組みを解説します。

第一の方法は、**DNS サーバーが Web サーバーの IP アドレスを回答するとき、最寄りのキャッシュ・サーバーの IP アドレスを回答するようにする**ことです。
具体的にはまず、Web サーバー側の DNS サーバーはキャッシュ・サーバーの設置場所のルーターから経路情報を集めておきます。
この経路情報を使って、DNS の問い合わせ元（クライアント側の DNS サーバー）に至る経路情報を調べます。
そこから近いルーターを調べて、そのルーターがある場所に設置されているキャッシュ・サーバーの IP アドレスを回答します。

第二の方法は、**リダイレクト用のサーバーを用意して、最寄りのキャッシュ・サーバーの IP アドレスにリダイレクトさせるようにする**ことです。
具体的にはまず、Web サーバー側の DNS サーバーにリダイレクト用のサーバーを登録しておきます。
リダイレクト用のサーバーは、先ほどの DNS サーバーと同様、ルーターから集めた経路情報を使って最寄りのキャッシュ・サーバーを探します。
そこへリダイレクトするようクライアントに伝えます。
こちらは、オーバーヘッドが多い一方で、DNS サーバーではなくクライアントの IP アドレスを元に距離を判断するので、より制度の高い方法です。

:::message
**キャッシュについて補足**
Web サーバーで元データが更新されたら、それを直ちにキャッシュ・サーバーに反映させる方法がある。
また、ページ内容が変わらない部分と変わる部分に分けて、変わらない部分だけをキャッシュする方法もある。
:::

## まとめ

Web サーバーを取り巻く関連技術は次のとおりです。

- ファイアウォール
  - パケット・フィルタリング
- 負荷分散
  - DNS ラウンドロビン
  - ロードバランサー
- キャッシュ・サーバー
  - リバース・プロキシ: Web サーバー側 LAN に設置
  - フォワード・プロキシ: クライアント側 LAN に設置
  - コンテンツ配信サービス: インターネット上に設置

## 参考

- [ネットワークはなぜつながるのか　第２版](https://www.amazon.co.jp/dp/B077XSB8BS)
